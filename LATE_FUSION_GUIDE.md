# 🎯 Late Fusion 기능 가이드

**추가일:** 2025년 10월 27일  
**기능:** 5초 간격 멀티모달 감정 통합

---

## ✨ 새로운 기능

### Late Fusion (지연 융합)

**5초 동안 쌓인 모든 감정 분석 결과를 통합하여 최종 감정을 추출합니다.**

- ⏱️ **5초 간격**: 자동으로 5초마다 결과 통합
- 🎭 **멀티모달**: 얼굴, 음성, 텍스트 결과를 모두 활용
- 🔄 **유연성**: 1개, 2개, 3개 모달리티 모두 지원
- 🎨 **빨간색 출력**: 최종 감정을 빨간색으로 강조 표시

---

## 🔬 Late Fusion 알고리즘

### 1단계: 데이터 수집 (5초간)

```
[0초] ─────────────────────────────────────→ [5초]
      │                                      │
      👤 얼굴: [결과1, 결과2, 결과3, ...]
      🎤 음성: [결과1]
      📝 텍스트: [결과1]
```

### 2단계: 모달리티별 평균 계산

```python
얼굴_평균 = mean([얼굴_결과1, 얼굴_결과2, 얼굴_결과3, ...])
음성_평균 = mean([음성_결과1])
텍스트_평균 = mean([텍스트_결과1])
```

### 3단계: Late Fusion (평균의 평균)

```python
최종_확률 = mean([얼굴_평균, 음성_평균, 텍스트_평균])
최종_감정 = argmax(최종_확률)
```

### 예시

**수집된 데이터:**
- 얼굴: 3개 결과 → 평균: [0.75, 0.08, 0.11, 0.04, 0.03]
- 음성: 1개 결과 → 평균: [0.60, 0.15, 0.15, 0.05, 0.05]
- 텍스트: 1개 결과 → 평균: [0.90, 0.03, 0.04, 0.02, 0.01]

**Late Fusion:**
```
(0.75 + 0.60 + 0.90) / 3 = 0.750 (happy)
(0.08 + 0.15 + 0.03) / 3 = 0.086 (depressed)
...
```

**최종 결과:** **HAPPY (75.0%)**

---

## 🎨 출력 형식

### 실행 중 출력

```
👤 얼굴 감정 분석 (19:30:15):
  happy: 0.750
  depressed: 0.080
  ...

🎤 음성 감정 분석:
  happy: 0.600
  depressed: 0.150
  ...

📝 텍스트 감정 분석:
  happy: 0.900
  depressed: 0.030
  ...
```

### 5초 후 Late Fusion 결과 (빨간색!)

```
================================================================================
🎯 LATE FUSION 결과 (5초 통합)
================================================================================

📊 사용된 모달리티:
   👤 얼굴: 3개 결과
   🎤 음성: 1개 결과
   📝 텍스트: 1개 결과

   총 3개 모달리티, 5개 결과 통합

================================================================================
   🏆 최종 감정: HAPPY
   📈 신뢰도: 75.0%
================================================================================
```

**⚠️ 위의 최종 감정 부분이 빨간색으로 표시됩니다!**

---

## 🚀 사용 방법

### 1. 프로그램 실행

```bash
cd /Users/qkrwnsmir/Desktop/seeksick-main
python3 main.py
```

### 2. 실시간 분석

- 웹캠과 마이크가 자동으로 시작됩니다
- 얼굴, 음성, 텍스트 감정이 실시간으로 분석됩니다
- 개별 결과가 콘솔에 출력됩니다

### 3. Late Fusion 결과 확인

- **5초마다 자동으로** 빨간색 결과가 출력됩니다
- 5초 동안 수집된 모든 결과가 통합됩니다
- 사용된 모달리티 개수와 결과 개수가 표시됩니다

### 4. 종료

- `q` 키를 눌러 종료합니다

---

## 📊 시나리오별 예시

### 시나리오 1: 모든 모달리티 사용

**5초 동안:**
- 얼굴 감정: 30개 (10 FPS × 3초)
- 음성 감정: 1-2개 (3초 버퍼)
- 텍스트 감정: 1-2개

**Late Fusion 결과:**
```
================================================================================
🎯 LATE FUSION 결과 (5초 통합)
================================================================================

📊 사용된 모달리티:
   👤 얼굴: 30개 결과
   🎤 음성: 2개 결과
   📝 텍스트: 2개 결과

   총 3개 모달리티, 34개 결과 통합

================================================================================
   🏆 최종 감정: HAPPY
   📈 신뢰도: 82.3%
================================================================================
```

### 시나리오 2: 얼굴 + 텍스트만

**5초 동안:**
- 얼굴 감정: 30개
- 음성 감정: 0개 (마이크 없음)
- 텍스트 감정: 1개

**Late Fusion 결과:**
```
================================================================================
🎯 LATE FUSION 결과 (5초 통합)
================================================================================

📊 사용된 모달리티:
   👤 얼굴: 30개 결과
   📝 텍스트: 1개 결과

   총 2개 모달리티, 31개 결과 통합

================================================================================
   🏆 최종 감정: SURPRISED
   📈 신뢰도: 67.8%
================================================================================
```

### 시나리오 3: 텍스트만

**5초 동안:**
- 얼굴 감정: 0개 (얼굴 없음)
- 음성 감정: 0개 (무음)
- 텍스트 감정: 1개

**Late Fusion 결과:**
```
================================================================================
🎯 LATE FUSION 결과 (5초 통합)
================================================================================

📊 사용된 모달리티:
   📝 텍스트: 1개 결과

   총 1개 모달리티, 1개 결과 통합

================================================================================
   🏆 최종 감정: DEPRESSED
   📈 신뢰도: 91.2%
================================================================================
```

---

## ⚙️ 설정 변경

### Fusion 간격 변경

`main.py` 파일에서 수정:

```python
# 전역 상수
FUSION_INTERVAL = 5.0  # 5초 → 원하는 시간으로 변경

# 예시
FUSION_INTERVAL = 3.0  # 3초마다 융합
FUSION_INTERVAL = 10.0  # 10초마다 융합
```

### 색상 변경

빨간색이 아닌 다른 색상을 원하면:

```python
# Late Fusion 클래스의 print_fusion_result() 함수에서
print(f"{Colors.BOLD}{Colors.RED}...")  # RED를 다른 색상으로 변경

# 사용 가능한 색상:
# Colors.RED, Colors.GREEN, Colors.YELLOW, Colors.BLUE
# Colors.MAGENTA, Colors.CYAN, Colors.WHITE
```

---

## 🔬 테스트

### Late Fusion 테스트

```bash
python3 test_late_fusion.py
```

**출력:**
- 2가지 시나리오 테스트
- Late Fusion 알고리즘 동작 확인
- 빨간색 출력 확인

---

## 💡 장점

### 1. 노이즈 감소

개별 결과의 순간적인 오류를 평균으로 완화합니다.

**예시:**
```
얼굴1: happy(0.9), depressed(0.1)
얼굴2: depressed(0.7), happy(0.3)  ← 일시적 오류
얼굴3: happy(0.85), depressed(0.15)

→ 평균: happy(0.88), depressed(0.15)  ✓ 오류 완화
```

### 2. 안정적인 결과

5초 동안의 누적 데이터로 더 신뢰할 수 있는 결과를 제공합니다.

### 3. 유연성

사용 가능한 모달리티만 자동으로 활용합니다.
- 카메라 없음 → 음성 + 텍스트만 사용
- 무음 → 얼굴 + 텍스트만 사용

### 4. 직관적 출력

빨간색 강조로 최종 결과를 명확하게 표시합니다.

---

## 📈 성능

### 처리 속도

- **개별 분석**: 즉시 (실시간)
- **Late Fusion**: 5초마다 (매우 빠름, <0.1초)

### 메모리 사용

- 5초 동안의 결과만 저장 (메모리 효율적)
- 융합 후 버퍼 자동 초기화

---

## 🎯 활용 사례

### 1. 실시간 감정 모니터링

- 고객 서비스: 5초마다 고객 감정 파악
- 교육: 학습자의 집중도/이해도 측정
- 의료: 환자 상태 모니터링

### 2. 비디오 감정 분석

- 영상 콘텐츠 분석
- 인터뷰 감정 평가
- 회의 분위기 파악

### 3. 연구 목적

- 멀티모달 학습 연구
- 감정 인식 알고리즘 비교
- Fusion 기법 실험

---

## 🐛 문제 해결

### Q: 빨간색이 표시되지 않아요

**A:** 터미널이 ANSI 색상 코드를 지원하는지 확인하세요.
- macOS Terminal: 기본 지원 ✅
- iTerm2: 기본 지원 ✅
- Windows CMD: 추가 설정 필요

### Q: 5초보다 더 자주 결과를 보고 싶어요

**A:** `FUSION_INTERVAL`을 줄이세요.
```python
FUSION_INTERVAL = 3.0  # 3초로 변경
```

### Q: Late Fusion 결과가 안 나와요

**A:** 5초 동안 최소 1개 이상의 결과가 있어야 합니다.
- 웹캠/마이크가 정상 작동하는지 확인
- 얼굴이 화면에 보이는지 확인
- 음성이 입력되는지 확인

---

## 📚 참고

### Late Fusion vs Early Fusion

| 방식 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **Late Fusion** | 개별 분석 후 결과 통합 | 유연, 모듈화 | 상호작용 부족 |
| **Early Fusion** | 데이터 통합 후 분석 | 상호작용 활용 | 복잡, 의존성 |

**이 프로젝트는 Late Fusion을 사용합니다!**

### 가중치 조정 (향후 개선)

현재는 모든 모달리티에 동일한 가중치(1.0)를 부여합니다.

**향후 개선안:**
```python
# 모달리티별 가중치
fused_probs = (
    face_avg * 0.4 +      # 얼굴 40%
    voice_avg * 0.3 +     # 음성 30%
    text_avg * 0.3        # 텍스트 30%
)
```

---

## 🎉 결론

**Late Fusion 기능으로 더욱 강력하고 안정적인 감정 분석이 가능합니다!**

- ✅ 5초 간격 자동 통합
- ✅ 멀티모달 유연성
- ✅ 빨간색 강조 출력
- ✅ 노이즈 감소
- ✅ 높은 신뢰도

---

**지금 바로 실행해보세요:**

```bash
python3 main.py
```

**5초 후 빨간색 최종 결과를 확인하세요!** 🎯🔴

---

**작성:** 2025년 10월 27일  
**버전:** main.py v2.0 (Late Fusion 추가)

