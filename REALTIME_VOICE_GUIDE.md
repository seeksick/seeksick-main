# 🎤 실시간 음성 인식 가이드

**업데이트:** 2025년 11월 10일  
**버전:** v2.0 - 실시간 대화 모드

---

## ✨ 새로운 기능

### 🔥 **실시간 음성 인식 (자동 대화)**

- ✅ **버튼 클릭 불필요** - 자동으로 계속 듣기
- ✅ **말하면 즉시 인식** - Web Speech API 사용
- ✅ **중간 결과 표시** - 말하는 동안 실시간 텍스트 표시
- ✅ **자동 전송** - 1초 침묵 후 자동으로 ChatGPT에 전송
- ✅ **사용자 음성은 터미널에만** 표시
- ✅ **AI 응답은 채팅창에만** 표시
- ✅ **On/Off 토글** - 필요시 음성 인식 중지 가능

---

## 🎯 사용 방법

### 자동 시작

1. **페이지 로드 시 자동으로 음성 인식 시작**
2. **초록색 버튼** - "실시간 음성 인식 중..."
3. **그냥 말하면 됩니다!**

### 실시간 대화 흐름

```
1. 사용자가 말하기 시작
   ↓
2. 중간 결과 실시간 표시 (회색 박스)
   "안녕하세요..."
   ↓
3. 말을 멈춤 (1초 대기)
   ↓
4. 자동으로 ChatGPT에 전송
   ↓
5. 터미널에 사용자 음성 로그
   INFO - 🎤 [음성 입력] 안녕하세요
   ↓
6. AI 응답 채팅창에 표시
   AI: "안녕하세요! 어떻게 도와드릴까요? 😊"
   ↓
7. 다시 듣기 모드로 전환
   (계속 반복)
```

### On/Off 토글

- **초록색 버튼 클릭** → 음성 인식 중지
- **회색 버튼 클릭** → 음성 인식 재시작

---

## 🎨 UI 구성

### 1. 음성 인식 토글 버튼

```
┌────────────────────────────────────────┐
│  🎤  실시간 음성 인식 중...             │  ← 초록색 (활성)
└────────────────────────────────────────┘

또는

┌────────────────────────────────────────┐
│  🎤  음성 인식 중지됨 (클릭하여 시작)   │  ← 회색 (비활성)
└────────────────────────────────────────┘
```

### 2. 실시간 상태 표시

```
┌────────────────────────────────────────┐
│  ● 듣고 있습니다...                     │  ← 초록색 점 깜빡임
│  ┌──────────────────────────────────┐  │
│  │ 안녕하세요 오늘 기분이...        │  │  ← 말하는 중 실시간 표시
│  └──────────────────────────────────┘  │
└────────────────────────────────────────┘
```

### 3. 텍스트 입력 (선택사항)

```
┌────────────────────────────────────────┐
│ 또는 텍스트로 입력하세요...             │
│                                        │
│                              [전송 📤] │
└────────────────────────────────────────┘
```

---

## 🔧 기술 구현

### Web Speech API

```javascript
// 실시간 음성 인식 초기화
recognition = new SpeechRecognition();
recognition.continuous = true;        // 계속 듣기
recognition.interimResults = true;    // 중간 결과 표시
recognition.lang = 'ko-KR';          // 한국어

// 음성 인식 결과 처리
recognition.onresult = (event) => {
    // 중간 결과 (말하는 중)
    if (!event.results[i].isFinal) {
        interimTextDiv.textContent = transcript;  // 실시간 표시
    }
    
    // 최종 결과 (말 끝)
    if (event.results[i].isFinal) {
        // 1초 침묵 후 자동 전송
        setTimeout(() => {
            sendVoiceMessage(transcript);
        }, 1000);
    }
};

// 자동 재시작
recognition.onend = () => {
    if (isListening) {
        recognition.start();  // 계속 듣기
    }
};
```

### 자동 전송 로직

```javascript
// 최종 결과 감지
if (finalTranscript) {
    console.log('🎤 인식된 음성:', finalTranscript);
    
    // 침묵 타이머 설정
    clearTimeout(silenceTimer);
    silenceTimer = setTimeout(() => {
        // 1초 침묵 후 전송
        sendVoiceMessage(finalTranscript.trim());
        finalTranscript = '';
    }, 1000);
}
```

### ChatGPT 전송

```javascript
async function sendVoiceMessage(text) {
    // ChatGPT에 전송
    const response = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            message: text,
            is_voice: true  // 터미널에만 로그
        })
    });
    
    const data = await response.json();
    
    // AI 응답만 채팅창에 표시
    addMessageToChat('ai', data.message);
}
```

---

## 📊 업데이트 요약

| 항목 | 이전 (v1.0) | 현재 (v2.0) |
|------|------------|------------|
| **음성 입력 방식** | 버튼 클릭 + 녹음 | 자동 실시간 인식 |
| **사용자 동작** | 🎤 클릭 → 말하기 → 🎤 클릭 | 그냥 말하기 |
| **중간 결과** | 없음 | 실시간 표시 |
| **전송 방식** | 수동 (버튼 클릭) | 자동 (1초 침묵 후) |
| **계속 듣기** | 아니오 | 예 (자동 재시작) |
| **사용자 음성 표시** | - | 터미널에만 |
| **AI 응답 표시** | 채팅창 | 채팅창 |

---

## 🚀 실행 방법

### 1. 서버 실행

```bash
cd /Users/qkrwnsmir/Desktop/seeksick-main
python3 app.py
```

### 2. 브라우저 접속

```
http://localhost:5001
```

### 3. 마이크 권한 허용

- 브라우저에서 마이크 권한 요청 시 **허용** 클릭
- 자동으로 음성 인식 시작

### 4. 대화 시작

- **그냥 말하면 됩니다!**
- 버튼 클릭 불필요
- 말을 멈추면 1초 후 자동 전송

---

## 💡 사용 팁

### 효과적인 대화

1. **자연스럽게 말하기**
   - 평소처럼 자연스럽게 말하면 됩니다
   - 문장 단위로 끊어서 말하면 더 정확

2. **침묵 활용**
   - 말을 멈추면 1초 후 자동 전송
   - 긴 문장은 중간에 잠깐 멈추지 말 것

3. **중간 결과 확인**
   - 회색 박스에 실시간으로 인식되는 텍스트 표시
   - 잘못 인식되면 다시 말하기

4. **필요시 중지**
   - 초록색 버튼 클릭하여 음성 인식 중지
   - 텍스트로 입력 가능

### 환경 설정

- **조용한 환경**: 배경 소음 최소화
- **명확한 발음**: 정확한 인식을 위해
- **적절한 거리**: 마이크와 30-50cm 거리

---

## 🔍 터미널 로그 예시

### 실시간 대화 시

```
2025-11-10 20:15:10,123 - INFO - 🎤 실시간 음성 인식 시작
2025-11-10 20:15:15,456 - INFO - 🎤 [음성 입력] 안녕하세요
2025-11-10 20:15:18,789 - INFO - 📊 감정 업데이트: happy (68.0%)
2025-11-10 20:15:25,234 - INFO - 🎤 [음성 입력] 오늘 날씨가 좋네요
2025-11-10 20:15:28,567 - INFO - 📊 감정 업데이트: happy (72.0%)
```

**채팅창:**
```
AI: 안녕하세요! 어떻게 도와드릴까요? 😊

AI: 네, 오늘 날씨가 정말 좋네요! 
    기분도 좋으신 것 같아요. 😊
```

---

## ⚠️ 주의사항

### 1. 브라우저 지원

**지원:**
- ✅ Chrome (권장)
- ✅ Edge
- ✅ Safari (macOS)

**미지원:**
- ❌ Firefox (Web Speech API 미지원)

### 2. 마이크 권한

- 브라우저에서 마이크 권한 필요
- HTTPS 또는 localhost에서만 작동
- 권한 거부 시 음성 인식 불가

### 3. 인식 정확도

- 한국어 지원 (Web Speech API)
- 명확한 발음 권장
- 배경 소음 주의
- 인터넷 연결 필요 (클라우드 기반)

### 4. 자동 재시작

- 음성 인식이 자동으로 재시작됨
- 필요시 버튼으로 중지 가능
- 페이지 새로고침 시 다시 자동 시작

---

## 🎉 완료!

**실시간 대화 모드가 완성되었습니다!**

### 주요 특징

✅ 자동 실시간 음성 인식  
✅ 버튼 클릭 불필요  
✅ 중간 결과 실시간 표시  
✅ 1초 침묵 후 자동 전송  
✅ 사용자 음성은 터미널에만  
✅ AI 응답은 채팅창에만  
✅ 계속 듣기 모드  
✅ On/Off 토글 가능  

---

## 🎬 사용 시나리오

### 시나리오: 자연스러운 대화

```
[페이지 로드]
→ 자동으로 음성 인식 시작
→ 초록색 버튼: "실시간 음성 인식 중..."

[사용자가 말하기 시작]
사용자: "안녕하세요"
→ 회색 박스에 "안녕하세요" 실시간 표시

[1초 침묵]
→ 자동으로 ChatGPT에 전송
→ 터미널: INFO - 🎤 [음성 입력] 안녕하세요

[AI 응답]
→ 채팅창: AI: "안녕하세요! 어떻게 도와드릴까요? 😊"

[계속 듣기]
→ 다시 듣기 모드로 전환
→ 사용자가 다시 말하면 반복
```

---

**지금 실행하고 자연스럽게 대화해보세요!** 🎉

```bash
python3 app.py
# http://localhost:5001
```

**그냥 말하면 됩니다! 버튼 클릭 불필요!** 🎤

